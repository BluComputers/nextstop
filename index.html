<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go To Town - Driver Interface</title>
    <style>
        :root {
            --gtt-yellow: #ffd700;
            --gtt-dark: #121212;
            --gtt-dark-blue: #002d5a;
            --gtt-green: #2e7d32;
            --gtt-red: #c62828;
            --gtt-grey: #333;
        }

        body { 
            font-family: 'Segoe UI', Roboto, sans-serif; 
            background: var(--gtt-dark); 
            color: white; 
            margin: 0; 
            padding: 10px; 
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .header-section {
            width: 100%;
            max-width: 800px;
            margin-bottom: 15px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        .logo-box {
            background: var(--gtt-dark-blue);
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-bottom: 4px solid var(--gtt-yellow);
        }

        .logo-box img { height: 50px; margin-bottom: 10px; }

        select#route-selector {
            width: 90%;
            padding: 12px;
            font-size: 1.1rem;
            border-radius: 8px;
            background: white;
            color: var(--gtt-dark-blue);
            font-weight: bold;
            border: 2px solid var(--gtt-yellow);
        }

        .header-branding { 
            background: var(--gtt-yellow); 
            color: #000; 
            padding: 10px; 
            font-weight: 900; 
            font-size: 1.2rem; 
            text-transform: uppercase;
        }

        #display { 
            background: #000; 
            border: 4px solid #333; 
            padding: 50px 20px; 
            border-radius: 15px; 
            margin-bottom: 20px; 
            width: 95%;
            max-width: 800px;
            box-shadow: inset 0 0 20px rgba(255,215,0,0.05);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .label { color: var(--gtt-yellow); font-size: 1.2rem; text-transform: uppercase; letter-spacing: 4px; margin-bottom: 15px; }
        #stop-name { font-size: 2.8rem; font-weight: bold; color: #fff; line-height: 1.1; }

        .controls-grid {
            display: grid;
            grid-template-columns: 80px 1fr 80px; 
            gap: 15px;
            width: 95%;
            max-width: 800px;
        }

        button { border: none; border-radius: 12px; cursor: pointer; font-weight: bold; color: white; display: flex; align-items: center; justify-content: center; text-align: center; }
        button:active { transform: scale(0.98); }

        #next-btn { background: var(--gtt-green); font-size: 2rem; padding: 40px; box-shadow: 0 6px 0 #1b5e20; }
        .sq-btn { width: 80px; height: 80px; font-size: 0.8rem; text-transform: uppercase; }
        #skip-btn { background: var(--gtt-grey); }
        #reset-btn { background: var(--gtt-red); }
        #gps-btn { background: #1565c0; width: 95%; max-width: 800px; margin-top: 15px; padding: 15px; font-size: 1rem; }
        
        .status-area { margin-top: auto; padding: 20px; display: flex; justify-content: space-between; font-size: 0.9rem; color: #666; width: 100%; max-width: 800px; }
        .gps-active { color: #4caf50; font-weight: bold; }
    </style>
</head>
<body>

    <div class="header-section">
        <div class="logo-box">
            <img src="https://www.gtt-online.co.uk/media/2193/logo.png" alt="Go To Town Logo">
            <select id="route-selector" onchange="changeRoute()">
                <option value="service5">Service 5: Gaywood Loop</option>
                <option value="northlynn2">North Lynn 2</option>
                <option value="service4">Service 4: The Grange</option>
                <option value="service3">Service 3: North & South Wootton</option>
                <option value="service3h">Service 3H: Industrial/Retail Loop</option>
            </select>
        </div>
        <div class="header-branding" id="route-title">Service 5 From Go To Town</div>
    </div>

    <div id="display">
        <div class="label">Next Stop</div>
        <div id="stop-name">Ready To Depart</div>
    </div>

    <div class="controls-grid">
        <button id="skip-btn" class="sq-btn" onclick="skipStop()">Skip<br>Stop</button>
        <button id="next-btn" onclick="manualNext()">NEXT STOP</button>
        <button id="reset-btn" class="sq-btn" onclick="resetRoute()">Reset<br>Route</button>
    </div>

    <button id="gps-btn" onclick="toggleGPS()">ENABLE GPS TRACKING</button>

    <div class="status-area">
        <span id="counter">Stop: 0 / 0</span>
        <span id="gps-status">GPS: OFF</span>
    </div>

    <script>
        const routeData = {
            service5: {
                title: "Service 5 From Go To Town",
                stops: [
                    ["Bus Station Kings Lynn", 52.7533, 0.4005], ["Kettlewell Lane", 52.7554, 0.4035],
                    ["Highgate School", 52.7562, 0.4093], ["King Edward VII School", 52.7578, 0.4135],
                    ["Tesco Gaywood", 52.7600, 0.4225], ["King John Avenue", 52.7592, 0.4278],
                    ["King's Lynn Academy", 52.7575, 0.4285], ["Almshouses", 52.7565, 0.4288],
                    ["Raynham Close", 52.7558, 0.4302], ["Raleigh Road", 52.7565, 0.4325],
                    ["Hall View Road", 52.7578, 0.4338], ["Oak Circle", 52.7590, 0.4320],
                    ["Leicester Avenue", 52.7605, 0.4305], ["Bishops Road", 52.7618, 0.4285],
                    ["Henry Bell Close", 52.7610, 0.4250], ["Tesco Gaywood", 52.7598, 0.4220],
                    ["The Woolpack", 52.7572, 0.4115], ["St Katherines Court", 52.7555, 0.4045],
                    ["Railway Station", 52.7538, 0.4030], ["Bus Station", 52.7533, 0.4005]
                ]
            },
            northlynn2: {
                title: "North Lynn 2 From Go To Town",
                stops: [
                    ["Bus Station", 52.7533, 0.4005], ["Austin Fields", 52.7575, 0.4010],
                    ["Burkitt Street", 52.7588, 0.3995], ["Townsend Terrace", 52.7610, 0.3980],
                    ["Smith Avenue", 52.7635, 0.3950], ["Turbus Road", 52.7650, 0.3930],
                    ["St Edmundsbury Road", 52.7665, 0.3920], ["Estuary Close", 52.7680, 0.3910],
                    ["Nottingham Road", 52.7660, 0.3950], ["Lady Jane Grey Road", 52.7645, 0.3980],
                    ["No.1", 52.7630, 0.4000], ["Reid Way", 52.7620, 0.4020],
                    ["Garden Court", 52.7605, 0.4015], ["Chadwick Square", 52.7590, 0.3985],
                    ["Lady Jane Grey Road", 52.7615, 0.3970], ["Waterside", 52.7625, 0.3955],
                    ["Greenpark Avenue", 52.7610, 0.3930], ["Shop", 52.7600, 0.3925],
                    ["Harecroft Parade", 52.7585, 0.3950], ["Burkitt Street", 52.7588, 0.3995],
                    ["Austin Fields", 52.7575, 0.4010], ["Railway Station", 52.7538, 0.4030],
                    ["Bus Station", 52.7533, 0.4005]
                ]
            },
            service4: {
                title: "Service 4: The Grange From Go To Town",
                stops: [
                    ["Bus Station", 52.7533, 0.4005], ["Kettlewell Lane", 52.7554, 0.4035],
                    ["Highgate School", 52.7562, 0.4093], ["King Edward VII School", 52.7578, 0.4135],
                    ["Tesco Gaywood", 52.7600, 0.4225], ["Lavender Road", 52.7612, 0.4210],
                    ["Rosebery Avenue", 52.7625, 0.4200], ["Beulah Street", 52.7640, 0.4185],
                    ["Bevis Way", 52.7655, 0.4160], ["Aconite Road", 52.7670, 0.4140],
                    ["Winter Nelis Way", 52.7685, 0.4125], ["Whisson Close", 52.7695, 0.4100],
                    ["Suffield Way", 52.7675, 0.4085], ["Reeves Avenue", 52.7660, 0.4070],
                    ["Penrose Close", 52.7650, 0.4060], ["Reeves Avenue", 52.7660, 0.4070],
                    ["Baldock Drive", 52.7640, 0.4050], ["Spenser Road", 52.7630, 0.4035],
                    ["Clifton Road", 52.7615, 0.4020], ["Carters Close", 52.7605, 0.4005],
                    ["Clifford Burman", 52.7595, 0.3990], ["Garden Court", 52.7605, 0.4015],
                    ["LynnSport", 52.7620, 0.4050], ["Stiffkey Court", 52.7635, 0.4070],
                    ["Shop", 52.7600, 0.3925], ["Harecroft Parade", 52.7585, 0.3950],
                    ["Burkitt Street", 52.7588, 0.3995], ["Austin Fields", 52.7575, 0.4010],
                    ["Railway Station", 52.7538, 0.4030], ["Bus Station", 52.7533, 0.4005]
                ]
            },
            service3: {
                title: "Service 3 From Go To Town",
                stops: [
                    ["Bus Station", 52.7533, 0.4005], ["Kettlewell Lane", 52.7554, 0.4035],
                    ["Highgate School", 52.7562, 0.4093], ["King Edward VII School", 52.7578, 0.4135],
                    ["Tesco Gaywood", 52.7600, 0.4225], ["Lavender Road", 52.7612, 0.4210],
                    ["Rosebery Avenue", 52.7625, 0.4200], ["Beulah Street", 52.7640, 0.4185],
                    ["Marsh Lane", 52.7660, 0.4170], ["Lilac Wood", 52.7680, 0.4180],
                    ["Grafton Road", 52.7700, 0.4200], ["Gresham Close", 52.7720, 0.4220],
                    ["Temple Road", 52.7740, 0.4240], ["Blackford Road", 52.7755, 0.4260],
                    ["Hemington Close", 52.7770, 0.4280], ["Lexham Road", 52.7785, 0.4290],
                    ["Euston Way", 52.7800, 0.4300], ["Stody Drive", 52.7815, 0.4280],
                    ["Langley Road", 52.7825, 0.4260], ["Deas Road", 52.7835, 0.4240],
                    ["Swan", 52.7850, 0.4250], ["Meadow Road", 52.7870, 0.4260],
                    ["Spinney Close", 52.7890, 0.4270], ["Keble Close", 52.7910, 0.4280],
                    ["Alban Road", 52.7930, 0.4290], ["The Green", 52.7950, 0.4300],
                    ["Village Hall", 52.7940, 0.4310], ["Fountaine Grove", 52.7880, 0.4350],
                    ["Castleacre Close", 52.7850, 0.4360], ["Bacton Close", 52.7830, 0.4370],
                    ["Oak Avenue", 52.7810, 0.4380], ["Castle Rising Road", 52.7790, 0.4390],
                    ["Deas Road", 52.7835, 0.4240], ["Langley Road", 52.7825, 0.4260],
                    ["Stody Drive", 52.7815, 0.4280], ["Euston Way", 52.7800, 0.4300],
                    ["Lexham Road", 52.7785, 0.4290], ["Hemington Close", 52.7770, 0.4280],
                    ["Blackford Road", 52.7755, 0.4260], ["Temple Road", 52.7740, 0.4240],
                    ["Gresham Close", 52.7720, 0.4220], ["Grafton Road", 52.7700, 0.4200],
                    ["Lilac Wood", 52.7680, 0.4180], ["Marsh Lane", 52.7660, 0.4170],
                    ["Beulah Street", 52.7640, 0.4185], ["Rosebery Avenue", 52.7625, 0.4200],
                    ["Lavender Road", 52.7612, 0.4210], ["Tesco Gaywood", 52.7598, 0.4220],
                    ["The Woolpack", 52.7572, 0.4115], ["St Katherines Court", 52.7555, 0.4045],
                    ["Railway Station", 52.7538, 0.4030], ["Bus Station", 52.7533, 0.4005]
                ]
            },
            service3h: {
                title: "Service 3H From Go To Town",
                stops: [
                    ["Bus Station", 52.7533, 0.4005], ["Austin Fields", 52.7575, 0.4010],
                    ["Retail Park", 52.7585, 0.4080], ["Bergen Way", 52.7620, 0.4120],
                    ["Bryggen Road", 52.7650, 0.4100], ["Hamburg Way", 52.7665, 0.4080],
                    ["Hamburg Way (Return)", 52.7665, 0.4080], ["St James Medical Practice", 52.7545, 0.4075],
                    ["South Wootton Lane", 52.7610, 0.4180], ["Ffolkes Drive", 52.7630, 0.4165],
                    ["Baldock Drive", 52.7640, 0.4050], ["Mill Lane (NW)", 52.7660, 0.4030],
                    ["Mill Lane (NE)", 52.7660, 0.4030], ["Empire Avenue", 52.7645, 0.4000],
                    ["Orb & Spectre", 52.7700, 0.4050], ["Nursery Lane", 52.7685, 0.4070],
                    ["Hamburg Way", 52.7665, 0.4080], ["Bergen Way", 52.7620, 0.4120],
                    ["Retail Park", 52.7585, 0.4080], ["Austin Fields", 52.7575, 0.4010],
                    ["Railway Station", 52.7538, 0.4030], ["Bus Station", 52.7533, 0.4005]
                ]
            }
        };

        let currentRouteKey = "service5";
        let currentIndex = -1;
        let gpsActive = false;
        let watchId = null;

        function changeRoute() {
            currentRouteKey = document.getElementById('route-selector').value;
            document.getElementById('route-title').innerText = routeData[currentRouteKey].title;
            resetRoute(false);
        }

        function updateDisplay(shouldSpeak) {
            const stops = routeData[currentRouteKey].stops;
            if (currentIndex >= 0 && currentIndex < stops.length) {
                const name = stops[currentIndex][0];
                document.getElementById('stop-name').innerText = name;
                document.getElementById('counter').innerText = `Stop: ${currentIndex + 1} / ${stops.length}`;
                if (shouldSpeak) speak(`Next stop: ${name}`);
            } else if (currentIndex >= stops.length) {
                document.getElementById('stop-name').innerText = "End of Route";
            }
        }

        function manualNext() {
            if (currentIndex < routeData[currentRouteKey].stops.length - 1) {
                currentIndex++;
                updateDisplay(true);
            }
        }

        function skipStop() {
            if (currentIndex < routeData[currentRouteKey].stops.length - 1) {
                currentIndex++;
                updateDisplay(false); 
            }
        }

        function resetRoute(ask = true) {
            if(!ask || confirm("Reset current route?")) {
                currentIndex = -1;
                document.getElementById('stop-name').innerText = "Ready To Depart";
                document.getElementById('counter').innerText = `Stop: 0 / ${routeData[currentRouteKey].stops.length}`;
                window.speechSynthesis.cancel();
            }
        }

        function toggleGPS() {
            const btn = document.getElementById('gps-btn');
            const status = document.getElementById('gps-status');
            if (!gpsActive) {
                if ("geolocation" in navigator) {
                    watchId = navigator.geolocation.watchPosition(checkLocation, null, {enableHighAccuracy: true});
                    gpsActive = true;
                    btn.innerText = "DISABLE GPS TRACKING";
                    status.innerText = "GPS: ACTIVE";
                    status.classList.add("gps-active");
                }
            } else {
                navigator.geolocation.clearWatch(watchId);
                gpsActive = false;
                btn.innerText = "ENABLE GPS TRACKING";
                status.innerText = "GPS: OFF";
                status.classList.remove("gps-active");
            }
        }

        function checkLocation(pos) {
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;
            const stops = routeData[currentRouteKey].stops;
            const nextIdx = currentIndex + 1;
            if (nextIdx < stops.length) {
                const dist = Math.sqrt(Math.pow(lat - stops[nextIdx][1], 2) + Math.pow(lon - stops[nextIdx][2], 2));
                if (dist < 0.0007) { 
                    currentIndex = nextIdx;
                    updateDisplay(true);
                }
            }
        }

        function speak(text) {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-GB';
            utterance.rate = 0.85;
            window.speechSynthesis.speak(utterance);
        }

        changeRoute();
    </script>
</body>
</html>
