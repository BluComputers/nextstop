<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go To Town - Driver Interface</title>
    <style>
        :root {
            --gtt-yellow: #ffd700;
            --gtt-dark: #121212;
            --gtt-dark-blue: #002d5a;
            --gtt-blue-active: #2b4593;
            --gtt-green: #2e7d32;
            --gtt-red: #c62828;
            --gtt-grey: #333;
        }

        body { 
            font-family: 'Segoe UI', Roboto, sans-serif; 
            background: var(--gtt-dark); 
            color: white; 
            margin: 0; 
            padding: 0; 
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* --- LEFT SIDEBAR (The Stop List) --- */
        #sidebar {
            width: 320px;
            background: #fff;
            color: #333;
            display: flex;
            flex-direction: column;
            border-right: 4px solid var(--gtt-yellow);
        }

        .sidebar-header {
            background: var(--gtt-dark-blue);
            color: white;
            padding: 15px;
            font-weight: bold;
        }

        #stop-list-container {
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px 0;
            position: relative;
        }

        /* Stop List Styling mimicking the image */
        .stop-item {
            display: flex;
            align-items: flex-start;
            padding: 10px 15px;
            position: relative;
            min-height: 60px;
        }

        .stop-item.active {
            background-color: #f0f4ff;
        }

        .stop-line-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-right: 15px;
            width: 20px;
        }

        .line-segment {
            width: 4px;
            background: var(--gtt-dark-blue);
            flex-grow: 1;
        }

        .stop-node {
            width: 14px;
            height: 14px;
            border: 3px solid var(--gtt-dark-blue);
            border-radius: 50%;
            background: white;
            z-index: 2;
        }

        .stop-item.active .stop-node {
            background: var(--gtt-dark-blue);
        }

        .stop-info {
            display: flex;
            flex-direction: column;
        }

        .stop-main-name {
            font-weight: bold;
            font-size: 1.1rem;
            color: #1a1a1a;
        }

        .stop-sub-name {
            font-size: 0.9rem;
            color: #666;
        }

        /* --- RIGHT MAIN CONTENT --- */
        #main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            background: var(--gtt-dark);
        }

        .header-section {
            width: 100%;
            max-width: 800px;
            margin-bottom: 15px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        .logo-box {
            background: var(--gtt-dark-blue);
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-bottom: 4px solid var(--gtt-yellow);
        }

        .logo-box img { height: 45px; margin-bottom: 10px; }

        select#route-selector {
            width: 90%;
            padding: 10px;
            font-size: 1rem;
            border-radius: 8px;
            font-weight: bold;
        }

        .header-branding { 
            background: var(--gtt-yellow); 
            color: #000; 
            padding: 8px; 
            font-weight: 900; 
            text-transform: uppercase;
            text-align: center;
        }

        #display { 
            background: #000; 
            border: 4px solid #333; 
            padding: 40px 20px; 
            border-radius: 15px; 
            margin-bottom: 20px; 
            width: 95%;
            max-width: 700px;
            text-align: center;
        }

        .label { color: var(--gtt-yellow); font-size: 1rem; text-transform: uppercase; letter-spacing: 4px; margin-bottom: 10px; }
        #stop-name { font-size: 2.5rem; font-weight: bold; color: #fff; line-height: 1.1; }

        .controls-grid {
            display: grid;
            grid-template-columns: 80px 1fr 80px; 
            gap: 15px;
            width: 95%;
            max-width: 700px;
        }

        button { border: none; border-radius: 12px; cursor: pointer; font-weight: bold; color: white; }
        #next-btn { background: var(--gtt-green); font-size: 1.8rem; padding: 30px; }
        .sq-btn { width: 80px; height: 80px; font-size: 0.8rem; text-transform: uppercase; }
        #skip-btn { background: var(--gtt-grey); }
        #reset-btn { background: var(--gtt-red); }
        #gps-btn { background: #1565c0; width: 95%; max-width: 700px; margin-top: 15px; padding: 12px; }
        
        .status-area { margin-top: auto; padding: 10px; display: flex; justify-content: space-between; font-size: 0.8rem; color: #666; width: 100%; max-width: 700px; }
        .gps-active { color: #4caf50; font-weight: bold; }
    </style>
</head>
<body>

    <div id="sidebar">
        <div class="sidebar-header" id="sidebar-route-name">Route 2</div>
        <div id="stop-list-container">
            </div>
    </div>

    <div id="main-content">
        <div class="header-section">
            <div class="logo-box">
                <img src="https://www.gtt-online.co.uk/media/2193/logo.png" alt="Go To Town Logo">
                <select id="route-selector" onchange="changeRoute()">
                    <option value="service5">Service 5: Gaywood Loop</option>
                    <option value="northlynn2">North Lynn 2</option>
                    <option value="service4">Service 4: The Grange</option>
                    <option value="service3">Service 3: North & South Wootton</option>
                    <option value="service3h">Service 3H: Industrial/Retail Loop</option>
                </select>
            </div>
            <div class="header-branding" id="route-title">Service 5 From Go To Town</div>
        </div>

        <div id="display">
            <div class="label">Next Stop</div>
            <div id="stop-name">Ready To Depart</div>
        </div>

        <div class="controls-grid">
            <button id="skip-btn" class="sq-btn" onclick="skipStop()">Skip<br>Stop</button>
            <button id="next-btn" onclick="manualNext()">NEXT STOP</button>
            <button id="reset-btn" class="sq-btn" onclick="resetRoute()">Reset<br>Route</button>
        </div>

        <button id="gps-btn" onclick="toggleGPS()">ENABLE GPS TRACKING</button>

        <div class="status-area">
            <span id="counter">Stop: 0 / 0</span>
            <span id="gps-status">GPS: OFF</span>
        </div>
    </div>

    <script>
        const routeData = {
            service5: {
                shortName: "Route 5",
                title: "Service 5 From Go To Town",
                stops: [
                    ["Bus Station Kings Lynn", "Transport Interchange"], ["Kettlewell Lane", "Kings Lynn (NE)"],
                    ["Highgate School", "Kings Lynn (E)"], ["King Edward VII School", "Kings Lynn (E)"],
                    ["Tesco Gaywood", "Gaywood (E)"], ["King John Avenue", "Kings Lynn"],
                    ["King's Lynn Academy", "Kings Lynn"], ["Almshouses", "Gaywood"],
                    ["Raynham Close", "Gaywood"], ["Raleigh Road", "Gaywood"],
                    ["Hall View Road", "Gaywood"], ["Oak Circle", "Gaywood"],
                    ["Leicester Avenue", "Gaywood"], ["Bishops Road", "Gaywood"],
                    ["Henry Bell Close", "Gaywood"], ["Tesco Gaywood", "Gaywood (W)"],
                    ["The Woolpack", "Gaywood"], ["St Katherines Court", "Kings Lynn"],
                    ["Railway Station", "Kings Lynn (S)"], ["Bus Station", "Transport Interchange"]
                ]
            },
            northlynn2: {
                shortName: "Route 2",
                title: "North Lynn 2 From Go To Town",
                stops: [
                    ["Transport Interchange", "Kings Lynn (Stand C)"], ["Austin Fields", "Kings Lynn (NW)"],
                    ["Burkitt Street", "North Lynn (E)"], ["Townsend Terrace", "North Lynn (E)"],
                    ["Smith Avenue", "North Lynn (NW)"], ["Turbus Road", "North Lynn (NW)"],
                    ["St Edmundsbury Road", "North Lynn (NW)"], ["Estuary Close", "North Lynn (NW)"],
                    ["Nottingham Road", "North Lynn (E)"], ["Lady Jane Grey Road", "North Lynn (E)"],
                    ["No.1", "North Lynn (NW)"], ["Reid Way", "North Lynn (opp 73)"],
                    ["Garden Court", "North Lynn (S)"], ["Chadwick Square", "Kings Lynn (W)"],
                    ["Lady Jane Grey Road", "North Lynn (W)"], ["Waterside", "North Lynn (S)"],
                    ["Greenpark Avenue", "North Lynn (SW)"], ["Shop", "North Lynn (SW)"],
                    ["Harecroft Parade", "North Lynn (W)"], ["Burkitt Street", "North Lynn (W)"],
                    ["Austin Fields", "Kings Lynn (SE)"], ["Railway Station", "Kings Lynn (S)"],
                    ["Bus Station", "Transport Interchange"]
                ]
            },
            service4: {
                shortName: "Route 4",
                title: "Service 4: The Grange From Go To Town",
                stops: [
                    ["Bus Station", "Transport Interchange"], ["Kettlewell Lane", "Kings Lynn (NE)"],
                    ["Highgate School", "Kings Lynn (E)"], ["King Edward VII School", "Kings Lynn (E)"],
                    ["Tesco Gaywood", "Gaywood (E)"], ["Lavender Road", "Kings Lynn (NE)"],
                    ["Rosebery Avenue", "Kings Lynn (NE)"], ["Beulah Street", "Kings Lynn (NE)"],
                    ["Bevis Way", "Kings Lynn (NW)"], ["Aconite Road", "Kings Lynn (NW)"],
                    ["Winter Nelis Way", "Kings Lynn (N)"], ["Whisson Close", "Kings Lynn (N)"],
                    ["Suffield Way", "Kings Lynn (S)"], ["Reeves Avenue", "Kings Lynn (E)"],
                    ["Penrose Close", "Kings Lynn (S)"], ["Reeves Avenue", "Kings Lynn (E)"],
                    ["Baldock Drive", "Kings Lynn (NE)"], ["Spenser Road", "Kings Lynn"],
                    ["Clifton Road", "Kings Lynn (W)"], ["Carters Close", "Kings Lynn (W)"],
                    ["Clifford Burman", "Kings Lynn (W)"], ["Garden Court", "North Lynn (S)"],
                    ["LynnSport", "Kings Lynn (SE)"], ["Stiffkey Court", "North Lynn (E)"],
                    ["Shop", "North Lynn (SW)"], ["Harecroft Parade", "North Lynn (W)"],
                    ["Burkitt Street", "North Lynn (W)"], ["Austin Fields", "Kings Lynn (SE)"],
                    ["Railway Station", "Kings Lynn (S)"], ["Bus Station", "Transport Interchange"]
                ]
            },
            service3: {
                shortName: "Route 3",
                title: "Service 3 From Go To Town",
                stops: [
                    ["Bus Station", "Transport Interchange"], ["Kettlewell Lane", "Kings Lynn (NE)"],
                    ["Highgate School", "Kings Lynn (E)"], ["King Edward VII School", "Kings Lynn (E)"],
                    ["Tesco Gaywood", "Gaywood (E)"], ["Lavender Road", "Kings Lynn (NE)"],
                    ["Rosebery Avenue", "Kings Lynn (NE)"], ["Beulah Street", "Kings Lynn (NE)"],
                    ["Marsh Lane", "Kings Lynn (N)"], ["Lilac Wood", "Kings Lynn (SE)"],
                    ["Grafton Road", "Kings Lynn (E)"], ["Gresham Close", "South Wootton (N)"],
                    ["Temple Road", "South Wootton (E)"], ["Blackford Road", "South Wootton (SE)"],
                    ["Hemington Close", "South Wootton (NE)"], ["Lexham Road", "South Wootton (N)"],
                    ["Euston Way", "South Wootton (NE)"], ["Stody Drive", "South Wootton (NW)"],
                    ["Langley Road", "South Wootton (SW)"], ["Deas Road", "South Wootton (W)"],
                    ["Swan", "South Wootton (N)"], ["Meadow Road", "South Wootton (N)"],
                    ["Spinney Close", "South Wootton (N)"], ["Keble Close", "North Wootton (N)"],
                    ["Alban Road", "North Wootton (N)"], ["The Green", "North Wootton (E)"],
                    ["Village Hall", "North Wootton (S)"], ["Fountaine Grove", "South Wootton (SW)"],
                    ["Castleacre Close", "South Wootton (S)"], ["Bacton Close", "South Wootton (E)"],
                    ["Oak Avenue", "South Wootton (S)"], ["Castle Rising Road", "South Wootton (E)"],
                    ["Deas Road", "South Wootton (E)"], ["Langley Road", "South Wootton (NE)"],
                    ["Stody Drive", "South Wootton (S)"], ["Euston Way", "South Wootton (SW)"],
                    ["Lexham Road", "South Wootton (S)"], ["Hemington Close", "South Wootton (SW)"],
                    ["Blackford Road", "South Wootton (NW)"], ["Temple Road", "South Wootton (W)"],
                    ["Gresham Close", "South Wootton (S)"], ["Grafton Road", "South Wootton (W)"],
                    ["Lilac Wood", "Kings Lynn (NW)"], ["Marsh Lane", "Kings Lynn (SW)"],
                    ["Beulah Street", "Kings Lynn (SW)"], ["Rosebery Avenue", "Kings Lynn (SW)"],
                    ["Lavender Road", "Kings Lynn (S)"], ["Tesco", "Gaywood (W)"],
                    ["The Woolpack", "Kings Lynn (NW)"], ["St Katherines Court", "Kings Lynn (SW)"],
                    ["Railway Station", "Kings Lynn (S)"], ["Bus Station", "Transport Interchange"]
                ]
            },
            service3h: {
                shortName: "Route 3H",
                title: "Service 3H From Go To Town",
                stops: [
                    ["Bus Station", "Transport Interchange"], ["Austin Fields", "Kings Lynn (NW)"],
                    ["Retail Park", "Kings Lynn (NE)"], ["Bergen Way", "Kings Lynn (W)"],
                    ["Bryggen Road", "North Lynn (E)"], ["Hamburg Way", "Kings Lynn (N)"],
                    ["Hamburg Way", "Kings Lynn (E)"], ["St James Medical Practice", "Kings Lynn (E)"],
                    ["South Wootton Lane", "Kings Lynn"], ["Ffolkes Drive", "Kings Lynn (W)"],
                    ["Baldock Drive", "Kings Lynn (SW)"], ["Mill Lane", "Kings Lynn (NW)"],
                    ["Mill Lane", "Kings Lynn (NE)"], ["Empire Avenue", "Kings Lynn (NE)"],
                    ["Orb & Spectre", "South Wootton (NE)"], ["Nursery Lane", "South Wootton (SW)"],
                    ["Hamburg Way", "Kings Lynn (SW)"], ["Bergen Way", "Kings Lynn (W)"],
                    ["Retail Park", "Kings Lynn (SW)"], ["Austin Fields", "Kings Lynn (SE)"],
                    ["Railway Station", "Kings Lynn (S)"], ["Bus Station", "Transport Interchange"]
                ]
            }
        };

        let currentRouteKey = "service5";
        let currentIndex = -1;

        function renderStopList() {
            const container = document.getElementById('stop-list-container');
            const route = routeData[currentRouteKey];
            document.getElementById('sidebar-route-name').innerText = route.shortName;
            
            container.innerHTML = "";
            route.stops.forEach((stop, index) => {
                const item = document.createElement('div');
                item.className = `stop-item ${index === currentIndex ? 'active' : ''}`;
                item.id = `stop-item-${index}`;

                item.innerHTML = `
                    <div class="stop-line-box">
                        <div class="stop-node"></div>
                        ${index < route.stops.length - 1 ? '<div class="line-segment"></div>' : ''}
                    </div>
                    <div class="stop-info">
                        <div class="stop-main-name">${stop[0]}</div>
                        <div class="stop-sub-name">${stop[1]}</div>
                    </div>
                `;
                container.appendChild(item);
            });

            // Scroll to active stop
            if (currentIndex >= 0) {
                const activeEl = document.getElementById(`stop-item-${currentIndex}`);
                activeEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        function changeRoute() {
            currentRouteKey = document.getElementById('route-selector').value;
            document.getElementById('route-title').innerText = routeData[currentRouteKey].title;
            resetRoute(false);
        }

        function updateDisplay(shouldSpeak) {
            const stops = routeData[currentRouteKey].stops;
            if (currentIndex >= 0 && currentIndex < stops.length) {
                const name = stops[currentIndex][0];
                document.getElementById('stop-name').innerText = name;
                document.getElementById('counter').innerText = `Stop: ${currentIndex + 1} / ${stops.length}`;
                if (shouldSpeak) speak(`Next stop: ${name}`);
            } else if (currentIndex >= stops.length) {
                document.getElementById('stop-name').innerText = "End of Route";
            }
            renderStopList();
        }

        function manualNext() {
            if (currentIndex < routeData[currentRouteKey].stops.length - 1) {
                currentIndex++;
                updateDisplay(true);
            }
        }

        function skipStop() {
            if (currentIndex < routeData[currentRouteKey].stops.length - 1) {
                currentIndex++;
                updateDisplay(false); 
            }
        }

        function resetRoute(ask = true) {
            if(!ask || confirm("Reset current route?")) {
                currentIndex = -1;
                document.getElementById('stop-name').innerText = "Ready To Depart";
                document.getElementById('counter').innerText = `Stop: 0 / ${routeData[currentRouteKey].stops.length}`;
                window.speechSynthesis.cancel();
                renderStopList();
            }
        }

        function speak(text) {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-GB';
            utterance.rate = 0.85;
            window.speechSynthesis.speak(utterance);
        }

        // Initialize
        changeRoute();
    </script>
</body>
</html>
